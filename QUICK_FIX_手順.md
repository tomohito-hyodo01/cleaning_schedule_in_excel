# 清掃スケジュール画像の変換 - クイックフィックス手順

## 問題の原因

元の画像には以下の問題があり、自動変換が困難です：

1. **透かし文字（"sample"）** - 二値化時にノイズとなる
2. **低コントラスト** - 罫線が薄く検出できない
3. **複雑なレイアウト** - ヘッダ部分と表部分が混在

## 解決手順

### 方法1: 前処理画像で変換（推奨）

```bash
# 1. 画像を前処理
python preprocess_image.py

# 2. 前処理済み画像で変換
convert_preprocessed.bat

# または
python main.py --cli schedule_image/清掃スケジュール_前処理済み.jpg -o output.xlsx
```

### 方法2: 手動で表部分のみ切り出し

**最も確実な方法：**

1. **Windowsペイントで開く**
   ```
   schedule_image/清掃スケジュール.jpg を右クリック → プログラムから開く → ペイント
   ```

2. **表部分のみ選択**
   - 選択ツールで、下の表部分のみを選択
   - 上のヘッダー部分（清掃責任仕訳、日程情報など）は除外

3. **切り取って新規保存**
   - 切り取り（Ctrl+X）
   - 新規作成
   - 貼り付け（Ctrl+V）
   - 名前を付けて保存 → `清掃スケジュール_表のみ.jpg`

4. **変換実行**
   ```bash
   python main.py --cli schedule_image/清掃スケジュール_表のみ.jpg -o output.xlsx
   ```

### 方法3: より高解像度でスキャン

現在の画像は 1280x720 で、解像度が低めです。

- **推奨解像度**: 300 DPI以上
- **スキャン設定**: カラー、JPEG品質 最高
- **撮影の場合**: 真上から、照明を均一に

## 現在の変換結果の問題点

**自動検出結果:**
- 検出グリッド: 4行 × 39列（実際は約50行×30列）
- セル数: 37個（実際は1000個以上）
- OCR信頼度: 0%

→ **表構造の検出が根本的に失敗しています**

## デバッグ画像で確認

以下のファイルで、どの段階で問題が発生しているか確認できます：

```
debug_output/
├── 清掃スケジュール_binary.png  ← 二値化結果（黒すぎる/白すぎる）
├── 清掃スケジュール_cells.png   ← セル検出結果（セルが少ない）
└── 前処理_比較.jpg               ← 前処理の効果確認
```

## 期待される改善

前処理後：
- ✓ 透かし文字が薄くなる
- ✓ 罫線がクッキリする
- ✓ ノイズが減る
- ✓ コントラストが改善

## まだ改善しない場合

### オプション1: パラメータ調整

`config_for_sample.json`を編集：

```json
{
  "table_detection": {
    "min_line_length": 30,        // もっと短い線も検出
    "horizontal_kernel_scale": 80, // より太いカーネル
    "vertical_kernel_scale": 80
  }
}
```

### オプション2: OCRエンジンを変更

PaddleOCRでうまくいかない場合、Tesseractを試す：

```bash
python main.py --cli input.jpg -o output.xlsx --engine tesseract
```

### オプション3: 専用ツールを使用

このような複雑な表の場合、専用のOCRツールが効果的：

- **Adobe Acrobat DC** - PDF→Excel変換
- **ABBYY FineReader** - 高精度OCR
- **Tabula** - PDF表抽出（無料）

## 現実的なアプローチ

**ハイブリッド方式を推奨：**

1. このツールで骨格（罫線・セル構造）を生成
2. テキスト部分は手動またはGoogle OCRで読み取り
3. Excelで最終調整

または：

1. 元の画像の表部分のみを切り出し
2. コントラスト・明るさを手動調整
3. 再度このツールで変換

